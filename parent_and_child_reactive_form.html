<!DOCTYPE html>
<html ng-app="myApp">
<head>
  <meta charset="UTF-8">
  <title>Parent & Two Child Components with Form</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.0/angular.min.js"></script>
  <style>
    .component {
      border: 1px solid #ccc;
      padding: 15px;
      margin: 10px;
      border-radius: 5px;
    }
    .error {
      color: red;
      font-size: 0.9em;
    }
  </style>
</head>

<body ng-controller="ParentCtrl">
  <div class="component">
    <h2>Parent Component</h2>
    <p>Parent Message: {{ parentMessage }}</p>
    <p>Child A Message: {{ childAMessage }}</p>
    <p>Child B Message: {{ childBMessage }}</p>
  </div>

  <!-- Child Components -->
  <child-a 
    message-to-child="messageToA" 
    on-update="onChildAUpdate(message)">
  </child-a>

  <child-b 
    message-to-child="messageToB" 
    on-update="onChildBUpdate(message)">
  </child-b>

  <div class="component">
    <h2>User Registration Form</h2>
    <form name="userForm" ng-submit="submitForm()" novalidate>
      <div>
        <label>Name:</label>
        <input 
          type="text" 
          name="name" 
          ng-model="user.name" 
          required
          minlength="3"
          ng-maxlength="20">
        <div class="error" ng-show="userForm.name.$touched && userForm.name.$error.required">
          Name is required
        </div>
        <div class="error" ng-show="userForm.name.$error.minlength">
          Name must be at least 3 characters
        </div>
      </div>

      <div>
        <label>Email:</label>
        <input 
          type="email" 
          name="email" 
          ng-model="user.email" 
          required>
        <div class="error" ng-show="userForm.email.$touched && userForm.email.$error.required">
          Email is required
        </div>
        <div class="error" ng-show="userForm.email.$error.email">
          Please enter a valid email
        </div>
      </div>

      <div>
        <label>Age:</label>
        <input 
          type="number" 
          name="age" 
          ng-model="user.age" 
          min="18" 
          max="100" 
          required>
        <div class="error" ng-show="userForm.age.$error.number">
          Please enter a valid number
        </div>
        <div class="error" ng-show="userForm.age.$error.min || userForm.age.$error.max">
          Age must be between 18 and 100
        </div>
      </div>

      <button type="submit" ng-disabled="userForm.$invalid">Submit</button>
    </form>

    <div ng-show="formSubmitted">
      <h3>Submitted Data:</h3>
      <pre>{{ submittedData | json }}</pre>
    </div>
  </div>

<script>
angular.module('myApp', [])
  .controller('ParentCtrl', function($scope) {
    // Parent data
    $scope.parentMessage = "Hello from Parent!";
    $scope.childAMessage = "";
    $scope.childBMessage = "";
    
    // Messages to children
    $scope.messageToA = "Hello from Parent to Child A!";
    $scope.messageToB = "Hello from Parent to Child B!";
    
    // Child event handlers
    $scope.onChildAUpdate = function(message) {
      $scope.childAMessage = message;
    };
    
    $scope.onChildBUpdate = function(message) {
      $scope.childBMessage = message;
    };
    
    // Form handling
    $scope.user = {};
    $scope.formSubmitted = false;
    
    $scope.submitForm = function() {
      if ($scope.userForm.$valid) {
        $scope.submittedData = angular.copy($scope.user);
        $scope.formSubmitted = true;
        console.log('Form submitted:', $scope.user);
      }
    };
  })
  
  // Child A Component
  .directive('childA', function() {
    return {
      restrict: 'E',
      scope: {
        messageToChild: '=',
        onUpdate: '&'
      },
      template: `
        <div class="component">
          <h3>Child Component A</h3>
          <p>From Parent: {{ messageToChild }}</p>
          <button ng-click="sendMessage()">Send Message to Parent</button>
        </div>
      `,
      link: function(scope) {
        scope.sendMessage = function() {
          scope.onUpdate({message: 'Hello from Child A!'});
        };
      }
    };
  })
  
  // Child B Component
  .directive('childB', function() {
    return {
      restrict: 'E',
      scope: {
        messageToChild: '=',
        onUpdate: '&'
      },
      template: `
        <div class="component">
          <h3>Child Component B</h3>
          <p>From Parent: {{ messageToChild }}</p>
          <button ng-click="sendMessage()">Send Message to Parent</button>
        </div>
      `,
      link: function(scope) {
        scope.sendMessage = function() {
          scope.onUpdate({message: 'Hello from Child B!'});
        };
      }
    };
  });
</script>
</body>
</html>